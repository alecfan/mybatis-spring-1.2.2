<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!--  AutoGenerated by lindzh  2015年11月17日 10:55 -->
<mapper namespace="org.mybatis.spring.cache.dao.TeamInfoDao">

	<resultMap id="TeamInfoResultMap" type="org.mybatis.spring.cache.pojo.TeamInfo">
		<id property="id" column="id"/>
		<result property="user_id" column="user_id"/>
		<result property="title" column="title"/>
		<result property="need_book" column="need_book"/>
		<result property="summary" column="summary"/>
		<result property="city_id" column="city_id"/>
		<result property="group_id" column="group_id"/>
		<result property="type" column="type"/>
		<result property="partner_id" column="partner_id"/>
		<result property="team_price" column="team_price"/>
		<result property="market_price" column="market_price"/>
		<result property="partner_price" column="partner_price"/>
		<result property="per_number" column="per_number"/>
		<result property="max_number" column="max_number"/>
		<result property="now_number" column="now_number"/>
		<result property="pre_number" column="pre_number"/>
		<result property="allowrefund" column="allowrefund"/>
		<result property="image" column="image"/>
		<result property="image0" column="image0"/>
		<result property="image1" column="image1"/>
		<result property="image2" column="image2"/>
		<result property="image3" column="image3"/>
		<result property="image4" column="image4"/>
		<result property="image5" column="image5"/>
		<result property="image6" column="image6"/>
		<result property="image7" column="image7"/>
		<result property="image8" column="image8"/>
		<result property="image9" column="image9"/>
		<result property="image10" column="image10"/>
		<result property="credit" column="credit"/>
		<result property="tag" column="tag"/>
		<result property="use_rule" column="use_rule"/>
		<result property="buyonce" column="buyonce"/>
		<result property="sort_order" column="sort_order"/>
		<result property="expire_time" column="expire_time"/>
		<result property="begin_time" column="begin_time"/>
		<result property="end_time" column="end_time"/>
		<result property="close_time" column="close_time"/>
		<result property="tohome" column="tohome"/>
		<result property="fbi" column="fbi"/>
		<result property="perunit" column="perunit"/>
		<result property="code" column="code"/>
		<result property="onsale" column="onsale"/>
		<result property="url" column="url"/>
		<result property="title2" column="title2"/>
		<result property="new_user_only" column="new_user_only"/>
		<result property="create_time" column="create_time"/>
		<result property="gift" column="gift"/>
		<result property="taggroup" column="taggroup"/>
		<result property="baokuan" column="baokuan"/>
		<result property="display_number" column="display_number"/>
		<result property="peisong_shijian" column="peisong_shijian"/>
		<result property="presale" column="presale"/>
		<result property="images" column="images"/>
		<result property="teamname" column="teamname"/>
		<result property="day_begin_time" column="day_begin_time"/>
		<result property="day_end_time" column="day_end_time"/>
		<result property="expire_days" column="expire_days"/>
		<result property="weight" column="weight"/>
		<result property="taguser" column="taguser"/>
		<result property="fixed_amount" column="fixed_amount"/>
		<result property="increase_inventory" column="increase_inventory"/>
		<result property="images_top" column="images_top"/>
		<result property="auto_unshelve" column="auto_unshelve"/>
		<result property="delete_time" column="delete_time"/>
		<result property="today_sale" column="today_sale"/>
		<result property="update_time" column="update_time"/>
		<result property="activity_id" column="activity_id"/>
		<result property="third_team_id" column="third_team_id"/>
		<result property="team_tag" column="team_tag"/>
		<result property="team_tag_value" column="team_tag_value"/>
		<result property="support_express" column="support_express"/>
		<result property="top_group_id" column="top_group_id"/>
	</resultMap>
	
	<insert id="addTeamInfo" useGeneratedKeys="true" keyProperty="id" parameterType="org.mybatis.spring.cache.pojo.TeamInfo">
		insert into team 
		(user_id,title,need_book,summary,city_id,group_id,type,partner_id,
		team_price,market_price,partner_price,
		per_number,max_number,now_number,pre_number,allowrefund,
		image,image0,image1,image2,image3,image4,image5,image6,credit,image7,image8,image9,image10,
		tag,use_rule,buyonce,sort_order,expire_time,begin_time,end_time,close_time,
		tohome,fbi,perunit,code,onsale,url,title2,
		new_user_only,create_time,gift,taggroup,baokuan,display_number,weight,
		peisong_shijian,presale,images,teamname, 
		day_begin_time, day_end_time,expire_days,taguser,images_top,today_sale,update_time,support_express) 
		values 
		(#{user_id},#{title},#{need_book},#{summary},#{city_id},#{group_id},#{type},#{partner_id},
		#{team_price},#{market_price},#{partner_price},
		#{per_number},#{max_number},#{now_number},#{pre_number},#{allowrefund},
		#{image},#{image0},#{image1},#{image2},#{image3},#{image4},#{image5},
		#{image6},#{credit},#{image7},#{image8},#{image9},#{image10},
		#{tag},#{use_rule},#{buyonce},#{sort_order},#{expire_time},#{begin_time},#{end_time},#{close_time},
		#{tohome},#{fbi},#{perunit},#{code},#{onsale},#{url},#{title2},
		#{new_user_only},#{create_time},#{gift},#{taggroup},#{baokuan},#{display_number},#{weight},
		#{peisong_shijian},#{presale},#{images},#{teamname},
		#{day_begin_time},#{day_end_time},#{expire_days},#{taguser},#{images_top},#{today_sale},#{update_time},#{support_express})
	</insert>
	
	<select id="getById" resultMap="TeamInfoResultMap">
		select * from team where id=#{id}
	</select>
	
	<update id="updateById" parameterType="org.mybatis.spring.cache.pojo.TeamInfo">
		update team set user_id=#{obj.user_id},title=#{obj.title},need_book=#{obj.need_book},summary=#{obj.summary},city_id=#{obj.city_id},
		group_id=#{obj.group_id},type=#{obj.type},partner_id=#{obj.partner_id},team_price=#{obj.team_price},market_price=#{obj.market_price},
		partner_price=#{obj.partner_price},per_number=#{obj.per_number},max_number=#{obj.max_number},now_number=#{obj.now_number},
		pre_number=#{obj.pre_number},allowrefund=#{obj.allowrefund},image=#{obj.image},image0=#{obj.image0},image1=#{obj.image1},
		image2=#{obj.image2},image3=#{obj.image3},image4=#{obj.image4},image5=#{obj.image5},image6=#{obj.image6},credit=#{obj.credit},
		image7=#{obj.image7},image8=#{obj.image8},image9=#{obj.image9},image10=#{obj.image10},
		tag=#{obj.tag},use_rule=#{obj.use_rule},buyonce=#{obj.buyonce},sort_order=#{obj.sort_order},expire_time=#{obj.expire_time},
		begin_time=#{obj.begin_time},end_time=#{obj.end_time},close_time=#{obj.close_time},tohome=#{obj.tohome},fbi=#{obj.fbi},
		perunit=#{obj.perunit},code=#{obj.code},onsale=#{obj.onsale},url=#{obj.url},title2=#{obj.title2},new_user_only=#{obj.new_user_only},
		create_time=#{obj.create_time},gift=#{obj.gift},taggroup=#{obj.taggroup},baokuan=#{obj.baokuan},
		display_number=#{obj.display_number},weight=#{obj.weight},peisong_shijian=#{obj.peisong_shijian},presale=#{obj.presale},images=#{obj.images},
		teamname=#{obj.teamname},day_begin_time=#{obj.day_begin_time},day_end_time=#{obj.day_end_time},expire_days=#{obj.expire_days},taguser=#{obj.taguser},
		images_top=#{obj.images_top},today_sale=#{obj.today_sale},update_time=#{obj.update_time}
		where id=#{obj.id}
	</update>
	
	<update id="incrNumby">
		update team  set now_number = now_number + #{count},today_sale = today_sale + #{count}  
		where id = #{id} and (max_number -now_number) &gt;= #{quantity}
	</update>
	
	<update id="updateMaxnumberAndCleanTodaySaleById">
		update team set max_number = #{maxNumber}, today_sale = 0 WHERE id = #{id}
	</update>
	
	<update id="updateActivityById">
		update team set activity_id = #{activity_id},team_price = #{team_price},fixed_amount = #{fixed_amount},
		tag = #{tag},taggroup = #{taggroup},taguser = #{taguser},new_user_only = #{new_user_only} WHERE id = #{id}
	</update>
	
	<update id="updateActivityIdAndTeamPriceAndFixedAmountById">
		update team set activity_id = #{activity_id},team_price = #{team_price},fixed_amount = #{fixed_amount},tag = #{tag},max_number = now_number + #{count}  WHERE id = #{id}
	</update>
	
	<delete id="deleteById">
		delete from team where id=#{id}
	</delete>
	

	<select id="getListByFbiAndTypeAndNotGrpupAndBeginExpire" resultMap="TeamInfoResultMap">
		select * from team where partner_id=#{partner_id} and
		fbi=#{fbi} and type=#{type} and group_id!=#{group_id} and group_id&gt;0 and begin_time&lt;=#{begin_time} and onsale=1
		order by sort_order desc
	</select>
	
	<select id="getFbiListByGroupIdAndBeginExpire" resultMap="TeamInfoResultMap">
		select * from team where partner_id=#{partner_id} and onsale=1 and
		fbi=1 and type=0 and group_id!=33 and group_id = #{group_id} and begin_time&lt;=#{begin_time} 
		order by sort_order desc
	</select>
	
	<select id="getFbiListCountByGroupIdAndBeginExpire" resultType="long">
		select count(*) from team where partner_id=#{partner_id} and
		fbi=1 and type=0 and group_id!=33 and group_id = #{group_id} and begin_time&lt;=#{begin_time}  and expire_time&gt;=#{expire_time}
	</select>
	
	<select id="getAllSellingFbiTeams" resultMap="TeamInfoResultMap">
		select * from team where partner_id=#{partner_id} and 
		fbi=1 and type=0 and group_id!=33 and group_id&gt;0 and expire_time&gt;=#{expire_time}
	</select>
	
	<select id="getCountByFbiAndTypeAndNotGrpupAndBeginExpire" resultType="long">
		select count(*) from team where
		fbi=#{fbi} and type=#{type} and group_id!=#{group_id} and group_id&gt;0 and begin_time&lt;=#{begin_time} and expire_time&gt;=#{expire_time}
	</select>
	
	<select id="getListByFbiAndTypeAndBeginStartEnd" resultMap="TeamInfoResultMap">
		select * from team where city_id=#{city_id} and 
		fbi=#{fbi} and type=#{type} and begin_time&gt;=#{bg_start_time} and begin_time&lt;=#{bg_end_time}
		order by begin_time asc,sort_order desc limit #{limit} offset #{offset}
	</select>
	
	<select id="getCountByFbiAndTypeAndBeginStartEnd" resultType="long">
		select count(*) from team where
		fbi=#{fbi} and type=#{type} and begin_time&gt;=#{bg_start_time} and begin_time&lt;=#{bg_end_time}
	</select>
	
	<select id="getCountByPartnerIdAndType" resultType="long">
		select count(*) from team where 
		type=#{type} and partner_id=#{partner_id}
	</select>
	
	<select id="getOneByPartnerIdAndType" resultMap="TeamInfoResultMap">
	select * from team where partner_id = #{partner_id} and type = #{type} order by sort_order limit 1
	</select>
	
	<select id="getListByPartnerAndTypeAndExpire" resultMap="TeamInfoResultMap">
		select * from team where
		partner_id=#{partner_id} and type=#{type} and expire_time &gt; #{expire_time}
		order by sort_order desc
	</select>
	
	<select id="getListByPartnerAndTypeAndExpireLimitOffset" resultMap="TeamInfoResultMap">
		select * from team where
		partner_id=#{partner_id} and type=#{type} and expire_time &gt; #{expire_time}
		order by sort_order desc limit #{limit} offset #{offset}
	</select>
	
	<select id="getListByPartnerId" resultMap="TeamInfoResultMap">
		select * from team where
		partner_id=#{partner_id} 
		order by sort_order desc limit #{limit} offset #{offset}
	</select>
	
	<select id="getListByPartnerIdNotNewUserOnly" resultMap="TeamInfoResultMap">
		select * from team where
		partner_id=#{partner_id}  and new_user_only = 0
		order by sort_order desc limit #{limit} offset #{offset}
	</select>
	
	<select id="getCountByPartnerId" resultType="int">
		select count(*) from team where 
		partner_id=#{partner_id}
	</select>
	
	<select id="getListByTagGroup" resultMap="TeamInfoResultMap">
		select * from team where taggroup=#{taggroup}
	</select>
	
	<select id="getListByPartnerIdAndExpireTimeAndIsBaokuan" resultMap="TeamInfoResultMap">
		select * from team where partner_id=#{partner_id} and baokuan &gt; 0 and expire_time&gt;=#{expire_time}
	</select>
	
	<select id="getCountByTagGroup" resultType="long">
		select count(*) from team where 
		taggroup=#{taggroup}
	</select>
	
	<select id="getByPartnerIdAndExirpeTimeNotActivityGoods" resultMap="TeamInfoResultMap">
		select * from team
		where type = 0 and partner_id = #{partner_id}
		and expire_time &gt; #{expire_time}
		order by sort_order desc
	</select>
	
	<select id="getOnSaleListByPartnerIdAndExpireTimeAndGroupId" resultMap="TeamInfoResultMap">
		select * from team
		where partner_id = #{partner_id}
		and type = 0
    	and expire_time &gt; #{expire_time}
		<if test="group_id !=-1">
			and group_id = #{group_id}
		</if>
		order by expire_time desc limit #{limit} offset #{offset}
	</select>
	
	<select id="getOnSaleCountByPartnerIdAndExpireTimeAndGroupId" resultType="long">
		select count(1) from team
		where partner_id = #{partner_id}
		and type = 0
    	and expire_time &gt; #{expire_time}
		<if test="group_id !=-1">
			and group_id = #{group_id}
		</if>
	</select>
	
	<select id="getOffShelfListByPartnerIdAndExirpeTimeAndGroupId" resultMap="TeamInfoResultMap">
		select * from team
		where partner_id = #{partner_id}
		and type = 0
		and expire_time &lt; #{expire_time}
		<if test="group_id !=-1">
			and group_id = #{group_id}
		</if>
		order by expire_time limit #{limit} offset #{offset}
	</select>
	
	<select id="getOffShelfCountByPartnerIdAndExpireTimeAndGroupId" resultType="long">
		select count(1) from team
		where partner_id = #{partner_id}
		and type = 0
		and expire_time &lt; #{expire_time}
		<if test="group_id !=-1">
			and group_id = #{group_id}
		</if>
	</select>
	
	<select id="getListSoldOutByPartnerIdNotActivityGoods" resultMap="TeamInfoResultMap">
		select * from team
		where type = 0 and partner_id = #{partner_id}
		and (max_number-now_number) &lt;= 0
		order by sort_order desc limit #{limit} offset #{offset}
	</select>
	
	<select id="getListByPartnerIdNotActivityGoods" resultMap="TeamInfoResultMap">
		select * from team
		where type = 0 and partner_id = #{partner_id}
		order by sort_order desc limit #{limit} offset #{offset}
	</select>
	
	<select id="getOneByPartnerIdAndBaokuan" resultMap="TeamInfoResultMap">
		select * from team where partner_id = #{partner_id} and team.baokuan &gt; 0 and expire_time &gt; #{expire_time}
		order by expire_time desc,id asc limit 1
	</select>
	
	<select id="getByPartnerIdAndEffectiveTeam" resultMap="TeamInfoResultMap">
		select * from team where
		partner_id=#{partner_id} and type=0 and expire_time &gt; #{expire_time}
		order by sort_order desc limit 1
	</select>
		
	<insert id="addTeamInfoByPartner" useGeneratedKeys="true" keyProperty="id" parameterType="org.mybatis.spring.cache.pojo.TeamInfo">
		insert into team(title,summary,partner_id,team_price,market_price,
		max_number,now_number,image,image1,image2,image3,image4,
		use_rule,expire_time,begin_time,end_time,tohome,fbi)
		 values(#{title},#{summary},#{partner_id},#{team_price},#{market_price},
		 #{max_number},#{now_number},#{image},#{image1},#{image2},
		 #{image3},#{image4},#{use_rule},#{expire_time},#{begin_time},
		 #{end_time},#{tohome},#{fbi})
	</insert>
	
	<select id="getFbiPresaleTeamsByCityId" resultMap="TeamInfoResultMap">
		select * from team where  partner_id=#{partner_id} and onsale=1 and
		city_id=#{city_id} and presale=1 and fbi = 1 and type=0 and group_id!=33 and begin_time&lt;=#{begin_time} and group_id&gt;0
		order by sort_order desc
	</select>
	
	<update id="updateOnSaleById">
		UPDATE team SET onsale = #{onsale}, auto_unshelve = #{auto_unshelve} WHERE id = #{id}
	</update>
	
	<select id="getListTodaySaleNotEmpty" resultMap="TeamInfoResultMap">
		SELECT * FROM dc.team WHERE team.today_sale > 0 limit #{limit} offset #{offset}
	</select>
	
	<update id="updateTodaySaleIsEmpty">
		update team set today_sale = #{today_sale} WHERE id = #{id}
	</update>
	
	<select id="getByPartnerIdAndCode" resultMap="TeamInfoResultMap">
		SELECT * FROM dc.team 
		WHERE partner_id=#{partner_id} 
		and code=#{code}
	</select>
	
</mapper>